@page "/dialogOrder/{ID_заказа}"
@rendermode InteractiveServer

@inherits ТестЗаполнениеЗаказы
@inject DialogService сервисДиалога

<RadzenStack>
    @* Style="padding: 20px" *@
    <RadzenTemplateForm TItem="Заказ" Data="заказ">
        <RadzenRow Style="margin: 5px">
            <RadzenLabel>
                Изменить план: @заказ.Товар.Наименование<br />
                Тип изменения: целевое значение
            </RadzenLabel>
        </RadzenRow>
        <RadzenRow>
            <RadzenLabel>
                Шт./кг.: Измерение: <RadzenDropDown Data="@(Enum.GetValues(typeof(ЕдиницыИзмерения)).Cast<Enum>())" @bind-Value=@заказ.ЕдиницыИзмерения
                                                    AllowClear="true" AllowFiltering="true" FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive" Name="DropDownEnums">
                </RadzenDropDown> <RadzenNumeric TValue="float" Value="заказ.Количество" />
            </RadzenLabel>
        </RadzenRow>
        <RadzenRow Style="width: 100%">
            <RadzenLabel Style="width: 100%">
                Причина корректировки: <br />
                <RadzenDropDown TValue="string" Data="@причиныКорректировкиВыбор" @bind-Value="@выбраннаяПричинаКорректировки" Change="ВыборПричиныКорректировки" Placeholder="Выберите причину корректировки..." Style="width: 100%" />
            </RadzenLabel>
        </RadzenRow>
        <RadzenRow Style="width: 100%">
            <RadzenLabel Style="width: 100%">
                <RadzenTextArea Disabled="@НедоступноПолеДругаяПричинаКорректировки" @bind-Value=@другаяПричинаКорректировки Style="width: 100%" />
            </RadzenLabel>
        </RadzenRow>
        <RadzenRow Style="float: right">
            <RadzenButton ButtonType="ButtonType.Submit">Применить</RadzenButton>
        </RadzenRow>
    </RadzenTemplateForm>
</RadzenStack>

@code {
    [Parameter] public int ID_заказа { get; set; }
    Заказ заказ;
    List<string> причиныКорректировкиВыбор;
    bool НедоступноПолеДругаяПричинаКорректировки = true;
    string выбраннаяПричинаКорректировки;
    string другаяПричинаКорректировки = "";

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        заказ = Заказы.Where(order => order.Id == ID_заказа).FirstOrDefault();

        причиныКорректировкиВыбор = new List<string>()
        {
            "Дозаказ", "Брак", "Ошибка прогноза", /* ..., */ "Другая причина"
        };

        if (!string.IsNullOrWhiteSpace(заказ.ПричинаКорректировки))
        {
            if (причиныКорректировкиВыбор.Contains(заказ.ПричинаКорректировки))
                выбраннаяПричинаКорректировки = заказ.ПричинаКорректировки;
            else
            {
                выбраннаяПричинаКорректировки = "Другая причина";
                НедоступноПолеДругаяПричинаКорректировки = false;
                другаяПричинаКорректировки = заказ.ПричинаКорректировки;
            }
        }
    }

    void ВыборПричиныКорректировки()
    {
        if (выбраннаяПричинаКорректировки == "Другая причина")
        {
            НедоступноПолеДругаяПричинаКорректировки = false;
        } else
        {
            НедоступноПолеДругаяПричинаКорректировки = true;
            другаяПричинаКорректировки = "";
        }         
    }

    void Применить(Заказ заказ)
    {
        Console.WriteLine(заказ.Количество);

    }
}
